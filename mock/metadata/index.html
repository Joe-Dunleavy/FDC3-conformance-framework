<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="index.css" />
</head>

<body>
  <p>Conformance Framework Metadata App</p>
  <p>This app is only used by the conformance framework for intent test purposes.</p>
  <p id="context"></p>
  <script src="lib/mock-functions.js"></script>
  <script src="./Glue42-libraries/web.umd.js"></script>
  <script src="./Glue42-libraries/fdc3.umd.js"></script>
  <script src="./Glue42-libraries/startSupport.js"></script>
  <script>
    let stats = document.getElementById("context");
    stats.innerHTML += "start/ ";
    onFdc3Ready().then(async () => {
      await closeWindowOnCompletion(window.fdc3);

      //get context from tests
      await window.fdc3.addContextListener(
        "metadataAppContext",
        async (context) => {
          stats.innerHTML = `context = ${JSON.stringify(context)}/ `;

          //execute command from test app and send back metad
          if (context.command === "sendGetInfoMetadataToTests") {
            stats.innerHTML += "inside sendgetinfo/ ";
            stats.innerHTML += "start/ ";
            const implMetadata = await fdc3.getInfo();
            const metadataContext = {
              type: "metadataContext",
              implMetadata: implMetadata
            }
            //stats.innerHTML += "sending metadatacontext/ ";
            sendContextToTests(metadataContext);
          } else if (context.command === "sendIntentMetadataToTests") {
            await window.fdc3.addIntentListener("aTestingIntent", (context, metadata) => {
              const metadataContext = {
                type: "metadataContext",
                contextMetadata: metadata
              }
              sendContextToTests(metadataContext);
            });
          }
        });
    });

    stats.innerHTML += "end/ ";
  </script>
</body>

</html>